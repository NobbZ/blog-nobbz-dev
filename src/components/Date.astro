---
import { DateTime } from 'luxon';

export interface Props {
	date: string | DateTime;
	lang?: string;
}

let { date, lang } = Astro.props;

lang = lang || 'en';

const datetime: string =
	date instanceof DateTime ? date.toISODate() : DateTime.fromISO(date).toISODate();

const timeData = { lang, datetime };
---

<time data-relative {...timeData}>{datetime}</time>

<script>
	import { DateTime } from 'luxon';

	const dateElemets = document.querySelectorAll<HTMLTimeElement>('[data-relative]');

	dateElemets.forEach((element) => {
		const date: DateTime = DateTime.fromISO(element.dateTime);

		const relative = date.setLocale(element.lang).toRelativeCalendar();

		element.innerHTML = `<abbr title=${element.dateTime}>${relative}</abbr>`;
	});
</script>
