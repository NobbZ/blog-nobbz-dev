---
import { DateTime } from 'luxon';

export interface Props extends astroHTML.JSX.TimeHTMLAttributes {
	format: string;
}

const { datetime, format } = Astro.props;

let { lang } = Astro.props;
lang = lang || 'en';

const timeData = { lang, datetime, 'data-format': format };

console.log({ format });
---

<time data-relative {...Astro.props} {...timeData}><slot>{datetime}</slot></time>

<script>
	import { DateTime } from 'luxon';

	const dateElemets = document.querySelectorAll<HTMLTimeElement>('[data-relative]');

	dateElemets.forEach((element) => {
		const date: DateTime = DateTime.fromISO(element.dateTime);

		const relative = date.setLocale(element.lang).toRelativeCalendar();
		const format = element.dataset.format || 'yyyy-MM-dd';
		console.log({ format });

		element.innerHTML = `<abbr title="${date.toFormat(format)}">${relative}</abbr>`;
	});
</script>
